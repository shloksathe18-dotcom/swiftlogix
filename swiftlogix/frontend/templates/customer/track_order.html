{% extends 'base.html' %}
{% block content %}
<h3>Track Order</h3>
<div class="input-group mb-3">
  <input id="oid" class="form-control" placeholder="Order ID" />
  <button id="btn" class="btn btn-outline-primary">Track</button>
</div>
<div id="map"></div>
<pre id="out" class="mt-3"></pre>
<script>
const map = SwiftLogix.initMap('map');
let marker;

document.getElementById('btn').onclick = async () => {
  const id = document.getElementById('oid').value;
  const res = await SwiftLogix.authFetch(`/api/customer/orders/${id}/track`);
  document.getElementById('out').textContent = JSON.stringify(res, null, 2);
  if (res.driver && res.driver.lat && res.driver.lng) {
    if (marker) marker.remove();
    marker = SwiftLogix.addMarker(map, res.driver.lat, res.driver.lng, 'Driver');
    map.setView([res.driver.lat, res.driver.lng], 14);
  }
};
</script>
{% endblock %}
